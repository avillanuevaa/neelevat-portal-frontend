<app-title [title]="'pageName.createOrganization'" [breadcrumbs]="breadcrumbs"></app-title>

<div id="kt_app_content" class="app-content flex-column-fluid">
  <div id="kt_app_content_container" class="app-container container-xxl">
    <div class="card row border-card-custom rounded-2">
      <form class="form" novalidate>
        <div class="card-body pt-5 ps-3 pe-5">


          <form [formGroup]="organisationForm">
            <div class="row">
              <div class="col-12">
                <label class="section-text pb-3">Company info</label>

                <div class="mb-0 pb-0 fv-row fv-plugins-icon-container pb-2">
                  <div class="d-flex gap-3">

                    <app-input class="row d-flex w-100 pe-2 pt-0 mx-1" [label]="'labels.organisationName'"
                               [placeholder]="''"
                               formControlName="organisationName"
                               [isInvalid]="organisationForm.controls.organisationName.invalid
                     && (organisationForm.controls.organisationName.dirty || organisationForm.controls.organisationName.touched)">
                    </app-input>

                    <app-input class="row d-flex w-100 pe-2 pt-0 mx-1" [label]="'labels.organisationLegalEntity'"
                               [placeholder]="''"
                               formControlName="organisationLegalName"
                               [isInvalid]="organisationForm.controls.organisationLegalName.invalid
                     && (organisationForm.controls.organisationLegalName.dirty || organisationForm.controls.organisationLegalName.touched)">
                    </app-input>

                    <app-switch class="w-50 ps-sm-2 " [label]="'labels.companyParent'" [bgColor]="bgColor.gray">
                    </app-switch>
                  </div>

                  <div class="d-flex"
                       [ngClass]="{'justify-content-end': organisationForm.controls.organisationLegalName.invalid && (organisationForm.controls.organisationLegalName.dirty || organisationForm.controls.organisationLegalName.touched)}">
                    <div class="w-50" *ngIf="(organisationForm.controls.organisationLegalName.invalid && (organisationForm.controls.organisationLegalName.dirty || organisationForm.controls.organisationLegalName.touched))
                    && !(organisationForm.controls.organisationName.invalid && (organisationForm.controls.organisationName.dirty || organisationForm.controls.organisationName.touched))"></div>
                    <div
                      *ngIf="organisationForm.controls.organisationName.invalid && (organisationForm.controls.organisationName.dirty || organisationForm.controls.organisationName.touched)"
                      class="text-danger w-50">
                      <div *ngIf="organisationForm.controls.organisationName.errors.required">The field Organisation
                        Name is
                        mandatory.
                      </div>
                      <div *ngIf="organisationForm.controls.organisationName.errors.pattern">The field Organisation Name
                        accepts
                        only letters.
                      </div>
                    </div>
                    <div
                      *ngIf="organisationForm.controls.organisationLegalName.invalid && (organisationForm.controls.organisationLegalName.dirty || organisationForm.controls.organisationLegalName.touched)"
                      class="text-danger w-50">
                      <div *ngIf="organisationForm.controls.organisationLegalName.errors.required">The field
                        Organisation Legal
                        Name is mandatory.
                      </div>
                      <div *ngIf="organisationForm.controls.organisationLegalName.errors.pattern">The field
                        Organisation Legal
                        Name accepts only letters.
                      </div>
                    </div>
                    <div class="w-25"></div>
                  </div>

                </div>

                <div class="mb-0 pb-0 fv-row fv-plugins-icon-container pb-2">
                  <div class="d-flex gap-1">

                    <app-select formControlName="parentOrganisation" [label]="'labels.parentOrganization'"
                                class="row d-flex pe-2 pt-0 mx-1 w-100" [options]="mainContactPersonSelector">
                    </app-select>

                    <!--                    <div class="select-wrapper w-100">-->
                    <!--                    <app-select formControlName="parentOrganisation" [label]="'labels.parentOrganization'"-->
                    <!--                                class="row d-flex pe-2 pt-0 mx-1 w-100" [options]="mainContactPersonSelector">-->
                    <!--                    </app-select>-->
                    <!--                      <div class="icon-wrapper">-->
                    <!--                        <span class="menu-icon"><span class="btn-label"-->
                    <!--                                                      [inlineSVG]="'./assets/media/icons/duotune/general/address_book.svg'"></span></span>-->
                    <!--                      </div>-->
                    <!--                    </div>-->

                    <app-select formControlName="organizationABC" [label]="'labels.organizationABC'"
                                class="row d-flex pe-2 pt-0 mx-1 w-50" [options]="mainContactPersonSelector">
                    </app-select>

                    <app-switch class="w-50 ps-sm-2 " [label]="'labels.consolidateAddress'" [bgColor]="bgColor.gray">
                    </app-switch>

                    <app-switch class="w-50 ps-sm-2 " [label]="'labels.parentUsersSubsidiary'" [bgColor]="bgColor.gray">
                    </app-switch>
                  </div>


                </div>

                <div class="mb-0 fv-row fv-plugins-icon-container pb-2">
                  <div class="d-flex gap-3">
                    <div class="row d-flex w-100 gap-3 pe-2">
                      <app-select formControlName="mainContactPerson" [label]="'labels.mainContactPerson'"
                                  class="row d-flex w-100 pe-2 pt-0 mx-1" [options]="mainContactPersonSelector">
                      </app-select>


                      <div class="pe-0 ps-4">

                        <app-input class="row d-flex w-100 pe-2 pt-0 mx-1" [label]="'labels.contactEmail'"
                                   [placeholder]="''"
                                   formControlName="contactEmail"
                                   [isInvalid]="organisationForm.controls.contactEmail.invalid
                     && (organisationForm.controls.contactEmail.dirty || organisationForm.controls.contactEmail.touched)">
                        </app-input>


                        <div
                          *ngIf="organisationForm.controls.contactEmail.invalid && (organisationForm.controls.contactEmail.dirty || organisationForm.controls.contactEmail.touched)"
                          class="text-danger w-50">
                          <div *ngIf="organisationForm.controls.contactEmail.errors.required">The field Contact Email is
                            mandatory.
                          </div>
                          <div *ngIf="organisationForm.controls.contactEmail.errors.email">The field Contact Email is
                            invalid.
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="w-100">
                      <app-textarea class="row d-flex w-100 pe-2 ps-5 pt-0 mx-1" [label]="'labels.about'"
                                    [placeholder]="'users.aboutDescriptionUser'"
                                    formControlName="aboutDescription">
                      </app-textarea>
                    </div>
                  </div>

                </div>


                <label class="section-text pb-3">Address details</label>

                <div class="mb-0 pb-0 fv-row fv-plugins-icon-container pb-2">
                  <div class="d-flex gap-0">

                    <app-input class="row d-flex w-100 pe-2 pt-0 mx-1" [label]="'labels.street'" [placeholder]="''"
                               formControlName="streetAddress"
                               [isInvalid]="organisationForm.controls.streetAddress.invalid
                     && (organisationForm.controls.streetAddress.dirty || organisationForm.controls.streetAddress.touched)">
                    </app-input>

                    <app-input class="row d-flex w-100 pe-2 pt-0 mx-1" [label]="'labels.buildingName'"
                               [placeholder]="''"
                               formControlName="buildingNameAddress">
                    </app-input>

                  </div>

                  <div
                    *ngIf="organisationForm.controls.streetAddress.invalid && (organisationForm.controls.streetAddress.dirty || organisationForm.controls.streetAddress.touched)"
                    class="text-danger w-50">
                    <div *ngIf="organisationForm.controls.streetAddress.errors.required">The field Street is
                      mandatory.
                    </div>
                  </div>

                </div>

                <div class="mb-0 fv-row fv-plugins-icon-container pb-2">
                  <div class="d-flex gap-0">
                    <app-input class="row d-flex w-100 pe-2 pt-0 mx-1" [label]="'labels.zipCode'" [placeholder]="''"
                               formControlName="zipCodeAddress"
                               [isInvalid]="organisationForm.controls.zipCodeAddress.invalid
                     && (organisationForm.controls.zipCodeAddress.dirty || organisationForm.controls.zipCodeAddress.touched)">
                    </app-input>

                    <app-input class="row d-flex w-100 pe-2 pt-0 mx-1" [label]="'labels.city'" [placeholder]="''"
                               formControlName="cityAddress"
                               [isInvalid]="organisationForm.controls.cityAddress.invalid
                     && (organisationForm.controls.cityAddress.dirty || organisationForm.controls.cityAddress.touched)">
                    </app-input>
                  </div>

                  <div class="d-flex"
                       [ngClass]="{'justify-content-end': organisationForm.controls.cityAddress.invalid && (organisationForm.controls.cityAddress.dirty || organisationForm.controls.cityAddress.touched)}">
                    <div
                      *ngIf="organisationForm.controls.zipCodeAddress.invalid && (organisationForm.controls.zipCodeAddress.dirty || organisationForm.controls.zipCodeAddress.touched)"
                      class="text-danger w-50">
                      <div *ngIf="organisationForm.controls.zipCodeAddress.errors.required">The Zip Code is
                        mandatory.
                      </div>
                      <div *ngIf="organisationForm.controls.zipCodeAddress.errors.pattern">The Zip Code accepts
                        only numbers.
                      </div>
                    </div>
                    <div
                      *ngIf="organisationForm.controls.cityAddress.invalid && (organisationForm.controls.cityAddress.dirty || organisationForm.controls.cityAddress.touched)"
                      class="text-danger w-50">
                      <div *ngIf="organisationForm.controls.cityAddress.errors.required">The field City is mandatory.
                      </div>
                      <div *ngIf="organisationForm.controls.cityAddress.errors.pattern">The field City accepts only
                        letters.
                      </div>
                    </div>
                  </div>
                </div>

                <div class="mb-0 fv-row fv-plugins-icon-container pb-2">
                  <div class="d-flex gap-0">

                    <app-input class="row d-flex w-100 pe-2 pt-0 mx-1" [label]="'labels.region'" [placeholder]="''"
                               formControlName="regionAddress">
                    </app-input>

                    <app-select formControlName="countryAddress" [label]="'labels.country'" [placeholder]="'test'"
                                class="row d-flex pe-2 pt-0 mx-1 w-100" [options]="countries">
                    </app-select>

                  </div>
                </div>

                <label class="section-text pb-3">Billing information</label>

                <div class="mb-0 pb-0 fv-row fv-plugins-icon-container pb-2 pt-2 ps-3">
                  <app-checkbox class="col-lg-8 pb-1" [label]="'labels.copyCompany'"
                  >
                  </app-checkbox>
                </div>

                <div class="mb-0 pb-0 fv-row fv-plugins-icon-container pb-2">
                  <div class="d-flex gap-0">

                    <app-input class="row d-flex w-100 pe-2 pt-0 mx-1" [label]="'labels.street'" [placeholder]="''"
                               formControlName="streetBilling"
                               [isInvalid]="organisationForm.controls.streetBilling.invalid
                     && (organisationForm.controls.streetBilling.dirty || organisationForm.controls.streetBilling.touched)">
                    </app-input>

                    <app-input class="row d-flex w-100 pe-2 pt-0 mx-1" [label]="'labels.buildingName'"
                               [placeholder]="''"
                               formControlName="buildingNameBilling">
                    </app-input>

                    <app-select formControlName="currency" [label]="'labels.currency'" [placeholder]="''"
                                class="row d-flex pe-2 pt-0 mx-1 w-100" [options]="currency">
                    </app-select>

                  </div>

                  <div
                    *ngIf="organisationForm.controls.streetBilling.invalid && (organisationForm.controls.streetBilling.dirty || organisationForm.controls.streetBilling.touched)"
                    class="text-danger w-50">
                    <div *ngIf="organisationForm.controls.streetBilling.errors.required">The field Street is
                      mandatory.
                    </div>
                  </div>

                </div>

                <div class="d-flex">

                  <div class="w-100 pt-2">

                    <div class="mb-0 fv-row fv-plugins-icon-container pb-2">
                      <div class="d-flex gap-0">
                        <app-input class="row d-flex w-100 pe-2 pt-0 mx-1" [label]="'labels.zipCode'"
                                   [placeholder]="''"
                                   formControlName="zipCodeBilling"
                                   [isInvalid]="organisationForm.controls.zipCodeBilling.invalid
                     && (organisationForm.controls.zipCodeBilling.dirty || organisationForm.controls.zipCodeBilling.touched)">
                        </app-input>

                        <app-input class="row d-flex w-100 pe-2 pt-0 mx-1" [label]="'labels.city'"
                                   [placeholder]="''"
                                   formControlName="cityBilling"
                                   [isInvalid]="organisationForm.controls.cityBilling.invalid
                     && (organisationForm.controls.cityBilling.dirty || organisationForm.controls.cityBilling.touched)">
                        </app-input>
                      </div>

                      <div class="d-flex"
                           [ngClass]="{'justify-content-end': organisationForm.controls.cityBilling.invalid && (organisationForm.controls.cityBilling.dirty || organisationForm.controls.cityBilling.touched)}">
                        <div
                          *ngIf="organisationForm.controls.zipCodeBilling.invalid && (organisationForm.controls.zipCodeBilling.dirty || organisationForm.controls.zipCodeBilling.touched)"
                          class="text-danger w-50">
                          <div *ngIf="organisationForm.controls.zipCodeBilling.errors.required">The Zip Code is
                            mandatory.
                          </div>
                          <div *ngIf="organisationForm.controls.zipCodeBilling.errors.pattern">The Zip Code accepts
                            only numbers.
                          </div>
                        </div>
                        <div
                          *ngIf="organisationForm.controls.cityBilling.invalid && (organisationForm.controls.cityBilling.dirty || organisationForm.controls.cityBilling.touched)"
                          class="text-danger w-50">
                          <div *ngIf="organisationForm.controls.cityBilling.errors.required">The field City is
                            mandatory.
                          </div>
                          <div *ngIf="organisationForm.controls.cityBilling.errors.pattern">The field City accepts only
                            letters.
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="mb-0 fv-row fv-plugins-icon-container pb-2">
                      <div class="d-flex gap-0">

                        <app-input class="row d-flex w-100 pe-2 pt-0 mx-1" [label]="'labels.region'"
                                   [placeholder]="''"
                                   formControlName="regionBilling">
                        </app-input>

                        <app-select formControlName="countryBilling" [label]="'labels.country'"
                                    [placeholder]="'USD'"
                                    class="row d-flex pe-2 pt-0 mx-1 w-100" [options]="countries">
                        </app-select>

                      </div>
                    </div>

                  </div>

                  <div class="w-100">
                    <app-textarea class="row d-flex w-100 pe-2 ps-5 pt-0 mx-1" [label]="'labels.billingInstructions'"
                                  [placeholder]="'users.aboutDescriptionOrganisation'"
                                  formControlName="billingInstructions">
                    </app-textarea>
                  </div>

                </div>

                <div class="row pt-3 pb-5">

                  <div class="col-5 px-4">
                    <label class="section-text pb-3">Company activities</label>
                    <div class="d-flex">
                      <ng-container>
                        <div class="fv-row w-50 ps-sm-6">
                          <ng-container *ngFor="let role of companyActivities | slice: 0: 2">
                            <ng-container *ngTemplateOutlet="toggle; context: { role }"></ng-container>
                          </ng-container>
                        </div>

                        <div class="fv-row w-50">
                          <ng-container *ngFor="let role of companyActivities | slice: 2">
                            <ng-container *ngTemplateOutlet="toggle; context: { role }"></ng-container>
                          </ng-container>
                        </div>
                      </ng-container>
                    </div>

                  </div>

                  <div class="col-6 px-4">
                    <label class="section-text pb-3">Company roles</label>
                    <div class="d-flex">
                      <ng-container>
                        <div class="fv-row w-50 ps-sm-6">
                          <ng-container *ngFor="let role of companyRoles | slice: 0: 6">
                            <ng-container *ngTemplateOutlet="toggle; context: { role }"></ng-container>
                          </ng-container>
                        </div>

                        <div class="fv-row w-50">
                          <ng-container *ngFor="let role of companyRoles | slice: 6">
                            <ng-container *ngTemplateOutlet="toggle; context: { role }"></ng-container>
                          </ng-container>
                        </div>
                      </ng-container>
                    </div>

                  </div>

                </div>

              </div>
            </div>
          </form>

          <div>
            <label class="section-text pb-3">Locations</label>

            <!-- Botón para abrir el modal -->
            <div class="fv-row fv-plugins-icon-container px-1 pt-3 pb-5">
              <a class="btn btn-sm fw-bold border-0 px-0" (click)="addLocation(locationModal)">
                <span class="btn-label" [inlineSVG]="'./assets/media/icons/duotune/general/add-plus.svg'"></span>
                <span class="a-link-color ps-3 fs-5 align-middle">{{ "buttons.addLocations" | translate }}</span>
              </a>
            </div>

            <!--Modal -->
            <ng-template #locationModal>
              <div class="modal-content">
                <div class="modal-header px-9">
                  <label class="popover-title"
                         id="ModalLabel1">{{ editingMode ? 'Edit Location' : 'Add Location' }}</label>
                  <button type="button" class="btn-close" (click)="locationModalRef.hide()" aria-label="Close"></button>
                </div>
                <form [formGroup]="locationForm" (ngSubmit)="onSubmitLocation()">
                  <div class="modal-body pt-3 pb-5">
                    <!-- Aquí coloca los campos del formulario -->

                    <app-input class="row d-flex w-100 pe-2 pt-0 mx-1" [label]="'labels.location'"
                               [placeholder]="'labels.addLocation'"
                               formControlName="location">
                    </app-input>

                    <app-input class="row d-flex w-100 pe-2 pt-0 mx-1" [label]="'labels.address'"
                               [placeholder]="'labels.addAddress'"
                               formControlName="address">
                    </app-input>

                    <app-input class="row d-flex w-100 pe-2 pt-0 mx-1" [label]="'labels.phone'"
                               [placeholder]="'labels.addPhone'"
                               formControlName="phone">
                    </app-input>

                    <app-input class="row d-flex w-100 pe-2 pt-0 mx-1" [label]="'labels.tmsRefNo'"
                               [placeholder]="'labels.addtsmRefNo'"
                               formControlName="tsmRefNo">
                    </app-input>
                  </div>
                  <div class="modal-footer py-3">

                    <app-button class="px-0" data-bs-dismiss="modal" [name]="'buttons.cancel'"
                                (click)="locationModalRef.hide()"
                                [btnColor]="btnColor.filterButtonWhiteBg"></app-button>
                    <ng-container *ngIf="!editingMode">
                      <app-button class="px-0" [name]="'buttons.create'" [disabled]="!locationForm.valid"
                                  [btnColor]="btnColor.filterButton"></app-button>
                    </ng-container>
                    <ng-container *ngIf="editingMode">
                      <app-button class="px-0" (click)="updateLocationRow();locationModalRef.hide()"
                                  [name]="'buttons.updateForm'"
                                  [disabled]="!locationForm.valid" [btnColor]="btnColor.filterButton"></app-button>
                    </ng-container>
                  </div>
                </form>
              </div>
            </ng-template>
          </div>


          <table class="table table-bordered table-striped table-hover fs-6 gy-2 mb-6" *ngIf="showLocationTable">
            <thead>
            <tr class="fs-7">
              <th class="p-lg-2 sorting padding-cells-thead" style="width: 28%">Location</th>
              <th class="p-lg-2 sorting padding-cells-thead" style="width: 28%">Address</th>
              <th class="p-lg-2 sorting padding-cells-thead" style="width: 28%">Phone</th>
              <th class="p-lg-2 sorting padding-cells-thead" style="width: 16%">TMS ref. no.</th>
              <th class="p-lg-2 sorting padding-cells-thead" style="width: 16%">Maintenance</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let data of locationsData; let i = index" [ngClass]="{'selected-row': i === selectedRowIndex}">
              <td class="py-0 center-vertically">{{ data.location }}</td>
              <td class="py-0 center-vertically">{{ data.address }}</td>
              <td class="py-0 center-vertically">{{ data.phone }}</td>
              <td class="py-0 center-vertically">{{ data.tsmRefNo }}</td>
              <td class="py-0">
                <!--      <button class="btn btn-sm btn-info me-2" (click)="editRow(i)">Edit</button>-->
                <!--      <button class="btn btn-sm btn-danger" (click)="deleteRow(i)">Delete</button>-->
                <app-action [name]="'edit'" (click)="editLocationRow(i, locationModal);"></app-action>
                <app-action [name]="'delete'"
                            (click)="openDeleteLocationConfirmationModal(i, deleteLocationConfirmationModal);locationModalRef.hide()"></app-action>
              </td>
            </tr>
            </tbody>
          </table>


          <ng-template #deleteLocationConfirmationModal>
            <div class="modal-content" style="z-index: 101">
              <div class="modal-header">
                <span class="btn-label" [inlineSVG]="'./assets/media/icons/duotune/general/warning-popover.svg'"></span>
                <label class="popover-title-warning ps-3">
                  Attention</label>
                <button type="button" class="btn-close" (click)="deleteLocationConfirmationModalRef.hide()"
                        aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="d-flex align-items-center">
                  <label class="text-modal-body">Are you sure you want to delete all information?</label>
                </div>
              </div>
              <div class="modal-footer">

                <app-button class="px-0" data-bs-dismiss="modal" [name]="'buttons.cancel'"
                            (click)="deleteLocationConfirmationModalRef.hide()"
                            [btnColor]="btnColor.filterButtonWhiteBg"></app-button>
                <app-button class="px-0" [name]="'buttons.yes'"
                            (click)="deleteLocationRow(rowToDeleteIndex); deleteLocationConfirmationModalRef.hide()"
                            [btnColor]="btnColor.filterButton"></app-button>
              </div>
            </div>
            <bs-modal-backdrop style="z-index: 100" class="modal-backdrop fade show"></bs-modal-backdrop>
          </ng-template>

          <div>
            <label class="section-text pb-3">Language aliases</label>

            <!-- Botón para abrir el modal -->
            <div class="fv-row fv-plugins-icon-container px-1 pt-3 pb-5">
              <a class="btn btn-sm fw-bold border-0 px-0" (click)="addLanguage(languageModal)">
                <span class="btn-label" [inlineSVG]="'./assets/media/icons/duotune/general/add-plus.svg'"></span>
                <span class="a-link-color ps-3 fs-5 align-middle">{{ "buttons.addLanguage" | translate }}</span>
              </a>
            </div>

            <!-- Modal -->
            <ng-template #languageModal>
              <div class="modal-content">
                <div class="modal-header px-9">
                  <label class="popover-title"
                         id="ModalLabel">{{ editingMode ? 'Edit Language' : 'Add Language' }}</label>
                  <button type="button" class="btn-close" (click)="languageModalRef.hide()" aria-label="Close"></button>
                </div>
                <form [formGroup]="languageForm" (ngSubmit)="onSubmitLanguage()">
                  <div class="modal-body pt-3 pb-5">

                    <app-select class="row d-flex w-100 pe-2 pt-0 mx-1 salutation" [options]="languages"
                                [placeholder]="'labels.addLanguage'"
                                [label]="'labels.language'"
                                formControlName="language">
                    </app-select>

                    <app-select class="row d-flex w-100 pe-2 pt-0 mx-1 salutation" [options]="type"
                                [placeholder]="'labels.addType'"
                                [label]="'labels.type'"
                                formControlName="type">
                    </app-select>

                    <app-input class="row d-flex w-100 pe-2 pt-0 mx-1" [label]="'labels.alias'"
                               [placeholder]="'labels.addAlias'"
                               formControlName="alias">
                    </app-input>
                  </div>
                  <div class="modal-footer py-3">

                    <app-button class="px-0" data-bs-dismiss="modal" [name]="'buttons.cancel'"
                                (click)="languageModalRef.hide()"
                                [btnColor]="btnColor.filterButtonWhiteBg"></app-button>
                    <ng-container *ngIf="!editingMode">
                      <app-button class="px-0" [name]="'buttons.create'" [disabled]="!languageForm.valid"
                                  [btnColor]="btnColor.filterButton"></app-button>
                    </ng-container>
                    <ng-container *ngIf="editingMode">
                      <app-button class="px-0" (click)="updateLanguageRow();languageModalRef.hide()"
                                  [name]="'buttons.updateForm'"
                                  [disabled]="!languageForm.valid" [btnColor]="btnColor.filterButton"></app-button>
                    </ng-container>
                  </div>
                </form>

              </div>
            </ng-template>
          </div>


          <table class="table table-bordered table-striped table-hover mb-0 fs-6 gy-2 mb-6" *ngIf="showLanguageTable">
            <thead>
            <tr class="fs-7">
              <th class="p-lg-2 sorting padding-cells-thead" style="width: 28%">Language</th>
              <th class="p-lg-2 sorting padding-cells-thead" style="width: 28%">Type</th>
              <th class="p-lg-2 sorting padding-cells-thead" style="width: 28%">Alias</th>
              <th class="p-lg-2 sorting padding-cells-thead" style="width: 16%">Maintenance</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let data of languagesData; let i = index" [ngClass]="{'selected-row': i === selectedRowIndex}">
              <td class="py-0 center-vertically">{{ getLanguageName(data.language) }}</td>
              <td class="py-0 center-vertically">{{ getTypeName(data.type) }}</td>
              <td class="py-0 center-vertically">{{ data.alias }}</td>
              <td class="py-0">
                <!--      <button class="btn btn-sm btn-info me-2" (click)="editRow(i)">Edit</button>-->
                <!--      <button class="btn btn-sm btn-danger" (click)="deleteRow(i)">Delete</button>-->
                <app-action [name]="'edit'" (click)="editLanguageRow(i, languageModal);"></app-action>
                <app-action [name]="'delete'"
                            (click)="openDeleteLanguageConfirmationModal(i, deleteLanguageConfirmationModal);languageModalRef.hide()"></app-action>
              </td>
            </tr>
            </tbody>
          </table>


          <ng-template #deleteLanguageConfirmationModal>
            <div class="modal-content" style="z-index: 101">
              <div class="modal-header">
                <span class="btn-label" [inlineSVG]="'./assets/media/icons/duotune/general/warning-popover.svg'"></span>
                <label class="popover-title-warning ps-3">
                  Attention</label>
                <button type="button" class="btn-close" (click)="deleteLanguageConfirmationModalRef.hide()"
                        aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="d-flex align-items-center">
                  <label class="text-modal-body">Are you sure you want to delete all information?</label>
                </div>
              </div>
              <div class="modal-footer">

                <app-button class="px-0" data-bs-dismiss="modal" [name]="'buttons.cancel'"
                            (click)="deleteLanguageConfirmationModalRef.hide()"
                            [btnColor]="btnColor.filterButtonWhiteBg"></app-button>
                <app-button class="px-0" [name]="'buttons.yes'"
                            (click)="deleteLanguageRow(rowToDeleteIndex); deleteLanguageConfirmationModalRef.hide()"
                            [btnColor]="btnColor.filterButton"></app-button>
              </div>
            </div>
            <bs-modal-backdrop style="z-index: 100" class="modal-backdrop fade show"></bs-modal-backdrop>
          </ng-template>

          <div>
            <label class="section-text pb-3">Users</label>

            <!-- Botón para abrir el modal -->
            <div class="fv-row fv-plugins-icon-container px-1 pt-3 pb-5">
              <a class="btn btn-sm fw-bold border-0 px-0" (click)="addUser(userModal)">
                <span class="btn-label" [inlineSVG]="'./assets/media/icons/duotune/general/add-plus.svg'"></span>
                <span class="a-link-color ps-3 fs-5 align-middle">{{ "buttons.addUser" | translate }}</span>
              </a>
            </div>

            <!--Modal -->
            <ng-template #userModal>
              <div class="modal-content">
                <div class="modal-header px-9">
                  <label class="popover-title"
                         id="ModalLabel2">{{ editingMode ? 'Edit User' : 'Add User' }}</label>
                  <button type="button" class="btn-close" (click)="userModalRef.hide()" aria-label="Close"></button>
                </div>
                <form [formGroup]="userForm" (ngSubmit)="onSubmitUser()">
                  <div class="modal-body pt-3 pb-5">
                    <!-- Aquí coloca los campos del formulario -->

                    <app-select formControlName="selectUser" [label]="'labels.user'"
                                class="row d-flex pe-2 pt-0 mx-1 w-100" [options]="selectUser">
                    </app-select>

                    <app-select formControlName="authorisation" [label]="'labels.authorisation'"
                                class="row d-flex pe-2 pt-0 mx-1 w-100" [options]="authorisation">
                    </app-select>

                    <app-select formControlName="roleTemplate" [label]="'labels.roleTemplate'"
                                class="row d-flex pe-2 pt-0 mx-1 w-100" [options]="roleTemplate">
                    </app-select>
                  </div>
                  <div class="modal-footer py-3">

                    <app-button class="px-0" data-bs-dismiss="modal" [name]="'buttons.cancel'"
                                (click)="userModalRef.hide()"
                                [btnColor]="btnColor.filterButtonWhiteBg"></app-button>
                    <ng-container *ngIf="!editingMode">
                      <app-button class="px-0" [name]="'buttons.create'" [disabled]="!userForm.valid"
                                  [btnColor]="btnColor.filterButton"></app-button>
                    </ng-container>
                    <ng-container *ngIf="editingMode">
                      <app-button class="px-0" (click)="updateUserRow();userModalRef.hide()"
                                  [name]="'buttons.updateForm'"
                                  [disabled]="!userForm.valid" [btnColor]="btnColor.filterButton"></app-button>
                    </ng-container>
                  </div>
                </form>
              </div>
            </ng-template>
          </div>


          <table class="table table-bordered table-striped table-hover fs-6 gy-2 mb-6" *ngIf="showUserTable">
            <thead>
            <tr class="fs-7">
              <th class="p-lg-2 sorting padding-cells-thead" style="width: 28%">User (optional)</th>
              <th class="p-lg-2 sorting padding-cells-thead" style="width: 28%">Authorisation</th>
              <th class="p-lg-2 sorting padding-cells-thead" style="width: 28%">Role template</th>
              <th class="p-lg-2 sorting padding-cells-thead" style="width: 16%">Maintenance</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let data of usersData; let i = index" [ngClass]="{'selected-row': i === selectedRowIndex}">
              <td class="py-0 center-vertically">{{ getSelectUserName(data.selectUser) }}</td>
              <td class="py-0 center-vertically">{{ getAuthorisationName(data.authorisation) }}</td>
              <td class="py-0 center-vertically">{{ getRoleTemplateName(data.roleTemplate) }}</td>
              <td class="py-0">
                <!--      <button class="btn btn-sm btn-info me-2" (click)="editRow(i)">Edit</button>-->
                <!--      <button class="btn btn-sm btn-danger" (click)="deleteRow(i)">Delete</button>-->
                <app-action [name]="'edit'" (click)="editUserRow(i, userModal);"></app-action>
                <app-action [name]="'delete'"
                            (click)="openDeleteUserConfirmationModal(i, deleteUserConfirmationModal);userModalRef.hide()"></app-action>
              </td>
            </tr>
            </tbody>
          </table>


          <ng-template #deleteUserConfirmationModal>
            <div class="modal-content" style="z-index: 101">
              <div class="modal-header">
                <span class="btn-label" [inlineSVG]="'./assets/media/icons/duotune/general/warning-popover.svg'"></span>
                <label class="popover-title-warning ps-3">
                  Attention</label>
                <button type="button" class="btn-close" (click)="deleteUserConfirmationModalRef.hide()"
                        aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="d-flex align-items-center">
                  <label class="text-modal-body">Are you sure you want to delete all information?</label>
                </div>
              </div>
              <div class="modal-footer">

                <app-button class="px-0" data-bs-dismiss="modal" [name]="'buttons.cancel'"
                            (click)="deleteUserConfirmationModalRef.hide()"
                            [btnColor]="btnColor.filterButtonWhiteBg"></app-button>
                <app-button class="px-0" [name]="'buttons.yes'"
                            (click)="deleteUserRow(rowToDeleteIndex); deleteUserConfirmationModalRef.hide()"
                            [btnColor]="btnColor.filterButton"></app-button>
              </div>
            </div>
            <bs-modal-backdrop style="z-index: 100" class="modal-backdrop fade show"></bs-modal-backdrop>
          </ng-template>

        </div>
      </form>
    </div>
  </div>
</div>


<ng-template #toggle let-role="role">
  <app-switch class="col-lg-12 pb-1" [label]="role.name" [bgColor]="bgColor.gray"
              [checked]="organisationForm.controls.roles.value.includes(role.value)">
  </app-switch>
</ng-template>

