<app-title [title]="'pageName.stock'" [markForCheck]="markForCheck" [breadcrumbs]="breadcrumbs"
           [titleButton]="titleButton">
</app-title>

<div id="kt_app_content" class="app-content flex-column-fluid">
  <div id="kt_app_content_container" class="app-container container-xxl">
    <div class="card row border-card-custom border-content margin-10">

      <div class="card-header row border-0 pe-3 mb-sm-1 mb-0 pb-0 min-h-50px">
        <div class="d-flex fs-2 tabs-container pb-0 p-top-5px">
          <app-tabs [tabs]="tabs" (changeTab)="changeTab($event)" [isPageTabs]="true" [activeTab]="'/stock/current'">
          </app-tabs>
        </div>
      </div>

      <div class="card-body pt-0 pb-1">
        <div id="kt_customers_table_wrapper">
          <div class="row content gx-5 mt-2 ">

            <div class="graphics-div pt-0 gap-0">

              <div class="pieces-total d-flex col-2 pt-0 h-100">
                <span class="label-text-pieces m-0 p-0">Pieces</span>
                <div class="row d-flex fv-row justify-content-center fv-plugins-icon-container px-0 w-100 h-100">
                  <div class="row w-100 px-0 h-100">
                    <div *ngFor="let chart of charts; let last = last" class="col-4 d-flex w-100 pt-0 px-0"
                         [ngClass]="{ 'pb-xxl-4': !last, 'pb-md-1': !last }"
                         data-kt-customer-table-toolbar="base">
                      <!--begin::Card toolbar-->
                      <span class="fw-bold px-0 icon-chart-statistics">
                      <div class="symbol pt-2 mb-4">
                        <img class="symbol-size" [src]="chart.icon"/>
                      </div></span>
                      <div
                        class="row d-flex m-0 p-0 gap-0 text-center align-items-end justify-content-center border-chart">
                        <!--begin::Toolbar-->
                        <span class="small-loader" *ngIf="loader"></span>
                        <span class="text-black pb-0 pt-1 fw-bold font-chart-size py-2 px-0"><span
                          *ngIf="!loader">{{chart.amount.toLocaleString()}}</span></span>
                        <div class="border-bottom-div chart-bar p-0 m-0"></div>
                        <span class="text-gray-500 pb-0 fw-bold font-chart-size">{{ chart.name | translate }}</span>
                        <!--end::Toolbar-->
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="pallets-total col-2 pt-0 h-100">
                <span class="label-text-pallets m-0 p-0">Pallets</span>

                <div class="row d-flex h-100 fv-row justify-content-center fv-plugins-icon-container w-100 px-0">
                  <div class="h-100 px-0">
                    <div *ngFor="let chart of chartTotal" class="d-flex pt-0 h-100 ps-6"
                         data-kt-customer-table-toolbar="base">
                      <div
                        class="row d-flex text-center align-items-end justify-content-center border-chart w-100 h-100 px-1 gap-0">
                        <!--begin::Toolbar-->
                        <span class="small-loader-pallets" *ngIf="loader"></span>
                        <span class="text-black fw-bold font-chart-size amount-padding px-0"><span
                          *ngIf="!loader">{{totalPallets.toLocaleString()}}</span></span>
                        <div class="border-bottom-div chart-bar"></div>
                        <span
                          class="text-gray-500 fw-bold font-chart-size py-3 px-0">{{ chart.name | translate }}</span>
                        <!--end::Toolbar-->
                      </div>
                    </div>
                  </div>
                </div>

              </div>

              <div class="units-by-whs gap-0 col-5 pe-3 h-100">
                <div class="d-flex w-100 gap-2 justify-content-end" [ngClass]="{ 'pb-3': loader }">
                  <app-button class="px-0" (click)="loadFilteredStocks()" id="resetButton" [name]="'buttons.reset'"
                              [btnColor]="btnColor.filterButtonWhiteBg"></app-button>
                  <app-button class="px-0" (click)="RenderChartPieces()" id="piecesButton" [name]="'buttons.pieces'"
                              [btnColor]="btnColor.filterButton"></app-button>
                  <app-button class="px-0" (click)="RenderChartPallets()" id="palletsButton" [name]="'buttons.pallets'"
                              [btnColor]="btnColor.filterButtonWhiteBg"></app-button>
                </div>

                <div id="chartContainer" style="position: relative;" class="units-by-category h-100 w-100">
                  <span *ngIf="!displayLabel" class="label-text-pieces chart-label m-0 p-0">Pallets by Whs
                    <div *ngIf="loader"
                         style="background-color: #FFFFFF; width: 100%; height: 200%; position: absolute; top: 0"></div></span>
                  <span *ngIf="displayLabel" class="label-text-pieces chart-label m-0 p-0">Pieces by Whs</span>
                  <canvas class="testing px-5 pt-5 pb-3 " id="myChartPalletsByWhs" height="183" width="412">
                  </canvas>
                  <canvas class="testing px-5 pt-5 pb-3 " id="myChartPiecesByWhs" height="183" width="412">
                  </canvas>
                  <div id="loadingOverlay" class="overlay h-100" *ngIf="loader">
                    <div class="loader"></div>
                  </div>
                </div>

              </div>

              <div class="units-by-category gap-0 col-3 h-100">
                <div id="chartContainer2" style="position: relative;" class="units-by-category h-100 w-100">
                  <span *ngIf="!displayLabel" class="label-text-pieces chart-label m-0 p-0">Pallets by Category
                    <div *ngIf="loader"
                         style="background-color: #FFFFFF; width: 100%; height: 100%; position: absolute; top: 0"></div></span>
                  <span *ngIf="displayLabel" class="label-text-pieces chart-label m-0 p-0">Pieces by Category</span>
                  <canvas class="testing px-3 pt-3 py-3 " id="myChartPalletsByCategory" height="209" width="253">
                  </canvas>
                  <canvas class="testing px-3 pt-3 pb-3 " id="myChartPiecesByCategory" height="209" width="253">
                  </canvas>
                  <div id="loadingOverlay2" class="overlay h-100 position-relative bottom-0" *ngIf="loader">
                    <div class="loader"></div>
                  </div>
                </div>

              </div>


            </div>

            <div class="d-flex m-0 p-0 pb-10">
              <div class="table-wrapper mt-3">

                <div class="d-flex justify-content-between h-30px">

                  <buttons-filter [buttonsFilterItems]="buttonsFilterItems"
                                  (applyFilter)="applyQuantityToDeliverFilter($event)"></buttons-filter>

                  <app-download-file class="justify-content-end d-flex align-items-center gap-2 gap-lg-3"
                                     [finishDisplayedRows]="finishDisplayedRows" [numbersOfElements]="numbersOfElements"
                                     [rows]="filteredStocks" [columns]="columns" [fileName]="'current-stock-table'">
                  </app-download-file>
                </div>

                <div class="table-responsive position-relative table-wrap mb-xxl-5 mb-md-2 table-height mt-2">
                  <table class="table table-bordered table-striped table-hover mb-0 fs-6 gy-2" id="kt_customers_table">
                    <thead class="thead-sticky">

                    <tr class="text-start font-thead fw-bold fs-6 gs-0"
                        cdkDropList cdkDropListOrientation="horizontal" (cdkDropListDropped)="onColumnDrop($event)">
                      <ng-container *ngFor="let column of columns; let columnIndex = index">
                        <th *ngIf="column.display" cdkDrag class="p-lg-2 min-w-80px sorting padding-cells-thead"
                            tabindex="0"
                            aria-controls="kt_customers_table" rowspan="1" colspan="1">
                          <div class="thead-block">
                            <span class="thead-block-text">
                              {{ column.name | translate }}
                            </span>

                            <span class="sort-icon ps-5" (click)="sortByParam(column.value)"
                                  [inlineSVG]="'assets/media/icons/duotune/general/up-down-arrows-blue.svg'">
                            </span>

                          </div>
                        </th>
                      </ng-container>
                    </tr>

                    <tr class="text-start fw-bold fs-6 gs-0">
                      <ng-container *ngFor="let column of columns">
                        <th *ngIf="column.display" tabindex="0" class="align-top" aria-controls="kt_customers_table"
                            rowspan="1" colspan="1" aria-label="Row: activate to sort column ascending">
                          <div class="text-nowrap">
                            <app-multiselect (onChangeWithoutEvent)="applyColumnFilter($event, column.value)"
                                             [markForCheck]="markForCheck" [options]="mainFilter[column.value]"
                                             [value]="activeFilters[column.value]" [placeholder]="'labels.filter'">
                            </app-multiselect>
                          </div>
                        </th>
                      </ng-container>
                    </tr>

                    </thead>

                    <tbody class="fw-semibold text-black">

                    <tr class="odd min-table-height row-font-size"
                        *ngFor="let stock of filteredStocks | slice: finishDisplayedRows - numbersOfElements: finishDisplayedRows">
                      <ng-container *ngFor="let column of columns">
                        <td class="padding-cells-tbody" *ngIf="column.display">
                          <div class="text-nowrap">{{ stock[column.value] }}</div>
                        </td>
                        <!--                        <td *ngIf="column.value === 'totalPallets'">{{ stock.totalPallets }}</td> &lt;!&ndash; AquÃ­ se muestra el valor totalPallets &ndash;&gt;-->
                      </ng-container>
                    </tr>

                    <app-spinner *ngIf="loader"></app-spinner>

                    </tbody>
                  </table>

                </div>

                <app-pagination (onChangePage)="changePage($event)"
                                (onChangeNumberOfElement)="changeNumberOfElement($event)" [resetPage]="resetPage"
                                [amountItems]="filteredStocks?.length">
                </app-pagination>
              </div>
              <div class="right-filter align-items-center card-toolbar-content border-gray-neelevat mt-3">

                <div class="row d-flex justify-content-center pb-3 border-gray-bottom mx-0">
                  <label class="pt-2 toolbar-title-text">Period</label>
                  <app-button [btnColor]="btnColor.graybgBluefont" [name]="'buttons.today'"
                              [isFullWidth]="true" class="pt-3 text-center"></app-button>
                  <app-datepicker [size]="'small'" [label]="'labels.from'"></app-datepicker>

                  <app-datepicker [size]="'small'" [label]="'labels.to'"></app-datepicker>
                </div>

                <!--              <app-download-file class="d-flex align-items-center gap-2 gap-lg-3"-->
                <!--                [finishDisplayedRows]="finishDisplayedRows" [numbersOfElements]="numbersOfElements"-->
                <!--                [rows]="filteredStocks" [columns]="columns" [fileName]="'current-stock-table'">-->
                <!--              </app-download-file>-->


                <app-right-filter class="px-3" (save)="saveChanges($event)" [columns]="columns">
                </app-right-filter>

                <!--              <app-right-filter class="" (updateFilter)="changeRightFilter()" [markForCheck]="markForCheck"-->
                <!--                                [filters]="mainFilter" [columns]="columns" [activeFilters]="activeFilters">-->
                <!--              </app-right-filter>-->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
