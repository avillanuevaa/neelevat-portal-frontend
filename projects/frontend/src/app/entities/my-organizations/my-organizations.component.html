<div>
  <label class="section-text pb-3">Roles of User / Organizations</label>

  <ul *ngIf="tenant">
   <li *ngFor="let item of tenant.items">{{ item.name }}</li>
  </ul>

  <!-- BotÃ³n para abrir el modal -->
  <div class="fv-row fv-plugins-icon-container px-1 pt-3 pb-4">
    <a class="btn btn-sm fw-bold border-0 px-0" (click)="addOrganization(organizationModal)">
      <span class="btn-label" [inlineSVG]="'./assets/media/icons/duotune/general/add-plus.svg'"></span>
      <span class="a-link-color ps-3 fs-5 align-middle">{{ "buttons.addOrganization" | translate }}</span>
    </a>
  </div>

  <!-- Modal -->
  <ng-template #organizationModal>
    <div class="modal-content">
      <div class="modal-header px-9 py-6">
        <label class="popover-title"
               id="ModalLabel">{{ editingMode ? 'Edit Organization' : 'Add Organization' }}</label>
        <button type="button" class="btn-close" (click)="organizationModalRef.hide()" aria-label="Close"></button>
      </div>
      <form [formGroup]="organizationForm" (ngSubmit)="onSubmit();organizationModalRef.hide()">
        <div class="modal-body pt-3 pb-5">
          <label class="section-text">Roles of User</label>

          <app-select class="row d-flex w-100 pe-2 pt-0 mx-1 salutation" [options]="userRights"
                      [placeholder]="'labels.addLanguage'"
                      [label]="'labels.userRights'"
                      formControlName="userRights">
          </app-select>

          <div class="col-8 d-flex py-6 px-4">

            <ng-container>
              <div class="fv-row w-50">
                <ng-container *ngFor="let role of userRoles | slice: 0: 4">
                  <ng-container *ngTemplateOutlet="toggle; context: { role }"></ng-container>
                </ng-container>
              </div>

              <div class="fv-row w-50">
                <ng-container *ngFor="let role of userRoles | slice: 4">
                  <ng-container *ngTemplateOutlet="toggle; context: { role }"></ng-container>
                </ng-container>
              </div>

            </ng-container>


          </div>

          <label class="section-text pb-3">Organizations</label>

          <app-select class="row d-flex w-100 pe-2 pt-0 mx-1 salutation" [options]="organization"
                      [placeholder]="'labels.addLanguage'"
                      [label]="'labels.selectOrganisation'"
                      formControlName="organization">
          </app-select>

        </div>
        <div class="modal-footer py-3">
          <app-button class="px-0" data-bs-dismiss="modal" [name]="'buttons.cancel'" (click)="organizationModalRef.hide()"
                      [btnColor]="btnColor.filterButtonWhiteBg"></app-button>
          <ng-container *ngIf="!editingMode">
            <app-button class="px-0" [name]="'buttons.create'" [disabled]="!organizationForm.valid"
                        [btnColor]="btnColor.filterButton"></app-button>
          </ng-container>
          <ng-container *ngIf="editingMode">
            <app-button class="px-0" (click)="updateRow();organizationModalRef.hide()" [name]="'buttons.updateForm'"
                        [disabled]="!organizationForm.valid" [btnColor]="btnColor.filterButton"></app-button>
          </ng-container>
        </div>
      </form>
    </div>
  </ng-template>
</div>

<!-- Tabla para mostrar los datos ingresados -->
<table class="table table-bordered table-striped table-hover mb-0 fs-6 gy-2" *ngIf="showTable">
  <thead>
  <tr class="fs-7">
    <th class="p-lg-2 sorting padding-cells-thead" style="width: 28%">User Rights</th>
    <th class="p-lg-2 sorting padding-cells-thead" style="width: 28%">Organizations</th>
    <th class="p-lg-2 sorting padding-cells-thead" style="width: 16%">Maintenance</th>
  </tr>
  </thead>
  <tbody>
  <tr *ngFor="let data of organizationsData; let i = index" [ngClass]="{'selected-row': i === selectedRowIndex}">
    <td class="py-0 center-vertically">{{ getuserRightsName(data.userRights) }}</td>
    <td class="py-0 center-vertically">{{ getOrganizationName(data.organization) }}</td>
    <td class="py-0">
      <!--      <button class="btn btn-sm btn-info me-2" (click)="editRow(i)">Edit</button>-->
      <!--      <button class="btn btn-sm btn-danger" (click)="deleteRow(i)">Delete</button>-->
      <app-action [name]="'edit'" (click)="editRow(i, organizationModal);"></app-action>
      <app-action [name]="'delete'" (click)="openDeleteConfirmationModal(i, deleteConfirmationModal);organizationModalRef.hide()"></app-action>
    </td>
  </tr>
  </tbody>
</table>


<ng-template #deleteConfirmationModal>
  <div class="modal-content" style="z-index: 101">
    <div class="modal-header">
      <span class="btn-label" [inlineSVG]="'./assets/media/icons/duotune/general/warning-popover.svg'"></span>
      <label class="popover-title-warning ps-3">
        Attention</label>
      <button type="button" class="btn-close" (click)="deleteConfirmationModalRef.hide()" aria-label="Close"></button>
    </div>
    <div class="modal-body">
      <div class="d-flex align-items-center">
        <label class="text-modal-body">Are you sure you want to delete all information?</label>
      </div>
    </div>
    <div class="modal-footer">

      <app-button class="px-0" data-bs-dismiss="modal" [name]="'buttons.cancel'"
                  (click)="deleteConfirmationModalRef.hide()"
                  [btnColor]="btnColor.filterButtonWhiteBg"></app-button>
      <app-button class="px-0" [name]="'buttons.yes'"
                  (click)="deleteRow(rowToDeleteIndex); deleteConfirmationModalRef.hide()"
                  [btnColor]="btnColor.filterButton"></app-button>
    </div>
  </div>
  <bs-modal-backdrop style="z-index: 100" class="modal-backdrop fade show"></bs-modal-backdrop>
</ng-template>

<ng-template #toggle let-role="role">
  <app-checkbox class="col-lg-8 pb-1" [label]="role.name"
                [checked]="organizationForm.controls.roles.value && organizationForm.controls.roles.value.includes(role.value)">
  </app-checkbox>
</ng-template>
